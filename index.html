<!DOCTYPE html>
<html>
<head>
  <title>Approval Form</title>
  <style>
    body { font-family: Arial; padding: 20px; max-width: 400px; margin: auto; }
    h2 { text-align: center; }
    button { margin: 10px 5px; }
    textarea { width: 100%; height: 80px; }
  </style>
</head>
<body>

  <h2>Approval Form</h2>

  <form id="approvalForm">
    <input type="hidden" id="requestId" value="" />

    <label><strong>Choose an action:</strong></label><br>
    <input type="radio" name="action" value="Approve" required> Approve<br>
    <input type="radio" name="action" value="Reject" required> Reject<br><br>

    <label for="comment"><strong>Comment (optional):</strong></label><br>
    <textarea id="comment" name="comment"></textarea><br><br>

    <button type="submit">Submit</button>
  </form>

  <p id="responseMsg" style="color: green;"></p>

  <script>
    const form = document.getElementById("approvalForm");
    const requestId = new URLSearchParams(window.location.search).get("RequestID");

    // Pre-fill hidden RequestID field
    document.getElementById("requestId").value = requestId;

    form.addEventListener("submit", async function (e) {
      e.preventDefault();

      const action = form.elements["action"].value;
      const comment = document.getElementById("comment").value;

      const payload = {
        RequestID: requestId,
        Action: action,
        Comment: comment
      };

      const response = await fetch("https://defaultcf22ed057b0542158410a3c209b002.39.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/e767dfe223d84a8c8b93235b2da511b2/triggers/manual/paths/invoke/?api-version=1", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
      });

      if (response.ok) {
        document.getElementById("responseMsg").innerText = "✅ Response submitted successfully!";
        form.reset();
      } else {
        alert("❌ Failed to submit. Try again.");
      }
    });
  </script>

</body>
</html>
